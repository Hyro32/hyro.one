---
import { getCollection } from 'astro:content'
import { getLangFromUrl } from '../i18n/utils'
import BlogPostCard from './cards/BlogPostCard.astro'

const posts = await getCollection('blog')
const lang = getLangFromUrl(Astro.url)
const tagParam = Astro.url.searchParams.get('tag')

const filteredPosts = posts
  .filter(
    (post) =>
      post.slug.startsWith(`${lang}/`) &&
      (!tagParam || tagParam === post.data.tag.toLowerCase())
  )
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
---

<ul class="latest-posts">
  {filteredPosts.map((post) => <BlogPostCard post={post} />)}
</ul>

<style>
  .latest-posts {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    gap: 40px;
    padding: 0;
  }
</style>
